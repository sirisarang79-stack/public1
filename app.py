import streamlit as st
import pandas as pd
import numpy as np

# --- í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • ---
st.set_page_config(
    page_title="ê¸°í›„ë³€í™” ìƒë¬¼ì˜í–¥ ëª¨ë‹ˆí„°",
    page_icon="ğŸŠ",
    layout="wide"
)

# --- ì œëª© ë° í—¤ë” ---
st.title("ğŸŒ ê¸°í›„ë³€í™”ì™€ ìƒíƒœê³„ì˜ ë³€í™”")
st.markdown("""
ì´ ëŒ€ì‹œë³´ë“œëŠ” ê¸°í›„ ë³€í™”ê°€ **ìƒë¬¼ ë‹¤ì–‘ì„±**ê³¼ **ì„œì‹ì§€**ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì‹œê°í™”í•©ë‹ˆë‹¤.
ë°ì´í„°ë¥¼ í†µí•´ ê³¼ê±°ë¥¼ ëŒì•„ë³´ê³ , ì‹œë®¬ë ˆì´ì…˜ì„ í†µí•´ ë¯¸ë˜ë¥¼ ì˜ˆì¸¡í•´ ë´…ì‹œë‹¤.
""")
st.divider()

# --- ì‚¬ì´ë“œë°” ì„¤ì • ---
with st.sidebar:
    st.header("âš™ï¸ ì„¤ì • ë° ë©”ë‰´")
    menu = st.radio("ë©”ë‰´ ì„ íƒ", ["ëŒ€ì‹œë³´ë“œ (Global Data)", "ìƒíƒœê³„ ì‹œë®¬ë ˆì´í„°", "í•œêµ­ì˜ ì‚¬ë¡€"])
    st.info("ğŸ’¡ **Update:** ê°ê·¤ ì¬ë°°ì§€ ë¶ìƒ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.")

# --- ë°ì´í„° ìƒì„± í•¨ìˆ˜ ---
@st.cache_data
def load_temp_data():
    years = np.arange(1850, 2101)
    anomaly = [0.05 * np.exp(0.025 * (y - 1900)) if y > 1900 else np.random.normal(0, 0.1) for y in years]
    data = pd.DataFrame({'Year': years, 'Temperature Anomaly (Â°C)': anomaly})
    return data

df = load_temp_data()

# --- 1. ëŒ€ì‹œë³´ë“œ íƒ­ ---
if menu == "ëŒ€ì‹œë³´ë“œ (Global Data)":
    st.subheader("ğŸ“ˆ ì§€êµ¬ í‰ê·  ê¸°ì˜¨ ìƒìŠ¹ ì¶”ì´")
    col1, col2 = st.columns([3, 1])
    with col1:
        st.line_chart(df.set_index('Year'), color="#FF4B4B")
    with col2:
        current_anomaly = df[df['Year'] == 2024]['Temperature Anomaly (Â°C)'].values[0]
        st.metric(label="2024ë…„ ê¸°ì¤€", value=f"+{current_anomaly:.2f}Â°C", delta="ì‚°ì—…í™” ì´ì „ ëŒ€ë¹„")
        st.warning("ìƒìŠ¹ ì¶”ì„¸ê°€ ì§€ì†ë˜ê³  ìˆìŠµë‹ˆë‹¤.")

    st.markdown("### ğŸ” ì£¼ìš” ë©¸ì¢… ìœ„ê¸°ì¢… ë°ì´í„°")
    species_data = {
        "ì´ë¦„": ["ë¶ê·¹ê³°", "ì‚°í˜¸ì´ˆ", "ë°”ë‹¤ê±°ë¶", "í™©ì œí­ê·„"],
        "ìœ„í—˜ ìš”ì¸": ["í•´ë¹™ ê°ì†Œ", "í•´ìˆ˜ ì˜¨ë‚œí™”", "ì‚°ë€ì§€ íŒŒê´´", "ìœ ë¹™ ê°ì†Œ"],
        "ë“±ê¸‰": ["ì·¨ì•½ (VU)", "ìœ„ê¸‰ (CR)", "ìœ„ê¸° (EN)", "ì¤€ìœ„í˜‘ (NT)"]
    }
    st.table(pd.DataFrame(species_data))

# --- 2. ìƒíƒœê³„ ì‹œë®¬ë ˆì´í„° íƒ­ ---
elif menu == "ìƒíƒœê³„ ì‹œë®¬ë ˆì´í„°":
    st.subheader("ğŸŒ¡ï¸ ì˜¨ë„ ìƒìŠ¹ ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´í„°")
    temp_rise = st.slider("ì§€êµ¬ ì˜¨ë„ ìƒìŠ¹í­ ì„ íƒ (Â°C)", 1.0, 5.0, 1.5, 0.5)
    st.divider()
    
    col1, col2 = st.columns(2)
    with col1:
        st.markdown(f"### ğŸŒ¡ï¸ +{temp_rise}Â°C ì„¸ê³„")
        if temp_rise < 1.5:
            st.success("ê¸°í›„ ë°©ì–´ì„  ë‚´ì— ìˆìŠµë‹ˆë‹¤.")
            emoji = "ğŸŒ¤ï¸"
        elif 1.5 <= temp_rise < 2.0:
            st.warning("í‹°í•‘ í¬ì¸íŠ¸ ì ‘ê·¼. ì‚°í˜¸ì´ˆ ëŒ€ëŸ‰ ì‚¬ë©¸.")
            emoji = "ğŸ”¥"
        elif 2.0 <= temp_rise < 3.0:
            st.error("ëŒì´í‚¬ ìˆ˜ ì—†ëŠ” í”¼í•´. ë¹™í•˜ ì†Œë©¸.")
            emoji = "ğŸ»â€â„ï¸ğŸ’§"
        else:
            st.error("ëŒ€ë©¸ì¢… ìœ„ê¸°. ìƒíƒœê³„ ë¶•ê´´.")
            emoji = "â˜ ï¸"
        st.markdown(f"<h1 style='text-align: center; font-size: 80px;'>{emoji}</h1>", unsafe_allow_html=True)

    with col2:
        st.markdown("### ğŸ¦‹ ìƒë¬¼í•™ì  ì˜í–¥ ì˜ˆì¸¡")
        if temp_rise >= 1.5: st.write("âŒ **ì‚°í˜¸ì´ˆ ë°±í™” í˜„ìƒ** ì‹¬í™”")
        if temp_rise >= 2.0: st.write("ğŸŸ **í•´ì–‘ ì–´ë¥˜** ì–´íšëŸ‰ ê¸‰ê°")
        if temp_rise >= 3.0: st.write("ğŸ¦Ÿ **ì—´ëŒ€ì„± ì „ì—¼ë³‘** ê³ ìœ„ë„ í™•ì‚°")
        if temp_rise >= 4.0: st.write("ğŸŒ **ì§€êµ¬ ìƒë¬¼ì¢…** ì ˆë°˜ ë©¸ì¢… ìœ„ê¸°")

# --- 3. í•œêµ­ì˜ ì‚¬ë¡€ íƒ­ (ì—…ë°ì´íŠ¸ë¨) ---
elif menu == "í•œêµ­ì˜ ì‚¬ë¡€":
    st.subheader("ğŸ‡°ğŸ‡· í•œë°˜ë„ ìƒíƒœê³„ ì§€ë„ê°€ ë°”ë€ë‹¤")
    st.markdown("ê¸°ì˜¨ ìƒìŠ¹ìœ¼ë¡œ ì¸í•´ ë†ì‘ë¬¼ ì¬ë°° í•œê³„ì„ ì´ ë¶ìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤.")
    
    # íƒ­ì„ 3ê°œë¡œ í™•ì¥
    tab1, tab2, tab3 = st.tabs(["ğŸ ì‚¬ê³¼ (ë¶ìƒ)", "ğŸŠ ê°ê·¤ (ìƒë¥™)", "ğŸŒ² ì¹¨ì—½ìˆ˜ (ìœ„ê¸°)"])
    
    # 1. ì‚¬ê³¼ íƒ­
    with tab1:
        st.markdown("#### ëŒ€êµ¬ ì‚¬ê³¼ëŠ” ì˜›ë§? ê°•ì›ë„ ì‚¬ê³¼ê°€ ì˜¨ë‹¤")
        st.caption("ì‚¬ê³¼ ì¬ë°° ì ì§€ê°€ ê²½ë¶ì—ì„œ ê°•ì›ë„ ì‚°ê°„ìœ¼ë¡œ ì´ë™í•˜ê³  ìˆìŠµë‹ˆë‹¤.")
        apple_loc = pd.DataFrame({
            'lat': [35.8, 36.5, 37.1, 38.1], # ëŒ€êµ¬ -> ì¶©ì£¼ -> ì •ì„  -> ì–‘êµ¬
            'lon': [128.6, 128.1, 128.5, 128.1],
        })
        st.map(apple_loc, zoom=6)

    # 2. ê°ê·¤ íƒ­ (ìƒˆë¡œ ì¶”ê°€ëœ ë¶€ë¶„)
    with tab2:
        st.markdown("#### ì œì£¼ ê°ê·¤? ì´ì   'ìœ¡ì§€' ê°ê·¤!")
        st.write("ë”°ëœ»í•œ ë‚¨í•´ì•ˆ ì¼ëŒ€ê¹Œì§€ ì•„ì—´ëŒ€ ê¸°í›„ê°€ í™•ì¥ë˜ë©° ê°ê·¤ ì¬ë°°ê°€ ê°€ëŠ¥í•´ì¡ŒìŠµë‹ˆë‹¤.")
        
        col_map, col_info = st.columns([2, 1])
        
        with col_map:
            # ê°ê·¤ ì¬ë°°ì§€ ë°ì´í„° (ì œì£¼ -> ì „ë‚¨/ê²½ë‚¨ í•´ì•ˆ -> ë‚´ë¥™)
            citrus_loc = pd.DataFrame({
                'lat': [33.35, 34.30, 34.60, 34.85, 35.10],
                'lon': [126.53, 126.70, 127.10, 128.40, 128.10],
                # ì œì£¼, ì™„ë„, ê³ í¥, í†µì˜/ê±°ì œ, ì§„ì£¼(ì˜ˆì¸¡)
            })
            st.map(citrus_loc, zoom=6, color="#FFA500") # ì£¼í™©ìƒ‰ í¬ì¸íŠ¸ ì‚¬ìš©(Streamlit ìµœì‹ ë²„ì „ ì§€ì› ì‹œ)
        
        with col_info:
            st.info("""
            **ì£¼ìš” ì´ë™ ê²½ë¡œ**
            1. **ì œì£¼ë„** (ì „í†µì  ì£¼ì‚°ì§€)
            2. **ì „ë‚¨ ì™„ë„/ê³ í¥** (í˜„ì¬ í™œë°œ)
            3. **ê²½ë‚¨ ê±°ì œ/í†µì˜** (ì¬ë°° í™•ëŒ€)
            4. **ê²½ë‚¨ ì§„ì£¼/ì „ë¶ ë“±** (ë¯¸ë˜ ì˜ˆì¸¡)
            """)
            st.success("ì´ì œ ë‚´ë¥™ ì§€ì—­ì—ì„œë„ ë…¸ì§€ ê°ê·¤ ì¬ë°°ê°€ ì‹œë„ë˜ê³  ìˆìŠµë‹ˆë‹¤.")

    # 3. ì¹¨ì—½ìˆ˜ íƒ­
    with tab3:
        st.markdown("#### ì‚¬ë¼ì§€ëŠ” í¬ë¦¬ìŠ¤ë§ˆìŠ¤ íŠ¸ë¦¬ (êµ¬ìƒë‚˜ë¬´)")
        st.error("ì§€ë¦¬ì‚°, í•œë¼ì‚°ì˜ êµ¬ìƒë‚˜ë¬´ê°€ ê¸°ì˜¨ ìƒìŠ¹ê³¼ ìˆ˜ë¶„ ë¶€ì¡±ìœ¼ë¡œ ë§ë¼ ì£½ê³  ìˆìŠµë‹ˆë‹¤.")
        st.progress(80, text="ì§€ë¦¬ì‚° êµ¬ìƒë‚˜ë¬´ ê³ ì‚¬ ì§„í–‰ë¥  (ì‹¬ê°)")
        st.write("êµ¬ìƒë‚˜ë¬´ëŠ” í•œêµ­ ê³ ìœ ì¢…ìœ¼ë¡œ, ì„¸ê³„ìì—°ë³´ì „ì—°ë§¹(IUCN) ë©¸ì¢…ìœ„ê¸°ì¢…ì…ë‹ˆë‹¤.")

st.divider()
st.caption("Data Source: Simulated based on KMA(ê¸°ìƒì²­) Climate Reports")
