import streamlit as st
import pandas as pd
import numpy as np
import time

# --- í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • ---
st.set_page_config(
    page_title="ê¸°í›„ë³€í™” ìƒë¬¼ì˜í–¥ ëª¨ë‹ˆí„°",
    page_icon="ğŸŒ±",
    layout="wide"
)

# --- ì œëª© ë° í—¤ë” ---
st.title("ğŸŒ ê¸°í›„ë³€í™”ì™€ ìƒíƒœê³„ì˜ ë³€í™”")
st.markdown("""
ì´ ëŒ€ì‹œë³´ë“œëŠ” ê¸°í›„ ë³€í™”ê°€ **ìƒë¬¼ ë‹¤ì–‘ì„±**ê³¼ **ì„œì‹ì§€**ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì‹œê°í™”í•©ë‹ˆë‹¤.
ë°ì´í„°ë¥¼ í†µí•´ ê³¼ê±°ë¥¼ ëŒì•„ë³´ê³ , ì‹œë®¬ë ˆì´ì…˜ì„ í†µí•´ ë¯¸ë˜ë¥¼ ì˜ˆì¸¡í•´ ë´…ì‹œë‹¤.
""")
st.divider()

# --- ì‚¬ì´ë“œë°” ì„¤ì • ---
with st.sidebar:
    st.header("âš™ï¸ ì„¤ì • ë° ë©”ë‰´")
    menu = st.radio("ë©”ë‰´ ì„ íƒ", ["ëŒ€ì‹œë³´ë“œ (Global Data)", "ìƒíƒœê³„ ì‹œë®¬ë ˆì´í„°", "í•œêµ­ì˜ ì‚¬ë¡€"])
    st.info("ğŸ’¡ **Tip:** ì‹œë®¬ë ˆì´í„° íƒ­ì—ì„œ ì˜¨ë„ ìƒìŠ¹í­ì„ ì¡°ì ˆí•´ë³´ì„¸ìš”.")

# --- ë°ì´í„° ìƒì„± í•¨ìˆ˜ (ì˜ˆì‹œ ë°ì´í„°) ---
@st.cache_data
def load_temp_data():
    # 1850ë…„ë¶€í„° 2100ë…„ê¹Œì§€ì˜ ì˜¨ë„ ìƒìŠ¹ ì¶”ì´ (ê°€ìƒ ë°ì´í„° + ì‹¤ì œ ì¶”ì„¸ ë°˜ì˜)
    years = np.arange(1850, 2101)
    base_temp = 0
    # ì§€ìˆ˜ í•¨ìˆ˜ì ìœ¼ë¡œ ì¦ê°€í•˜ëŠ” íŠ¸ë Œë“œ ìƒì„±
    anomaly = [0.05 * np.exp(0.025 * (y - 1900)) if y > 1900 else np.random.normal(0, 0.1) for y in years]
    data = pd.DataFrame({'Year': years, 'Temperature Anomaly (Â°C)': anomaly})
    return data

df = load_temp_data()

# --- 1. ëŒ€ì‹œë³´ë“œ íƒ­ ---
if menu == "ëŒ€ì‹œë³´ë“œ (Global Data)":
    st.subheader("ğŸ“ˆ ì§€êµ¬ í‰ê·  ê¸°ì˜¨ ìƒìŠ¹ ì¶”ì´")
    
    col1, col2 = st.columns([3, 1])
    
    with col1:
        st.line_chart(df.set_index('Year'), color="#FF4B4B")
    
    with col2:
        st.write("### í˜„ì¬ ìƒíƒœ")
        current_anomaly = df[df['Year'] == 2024]['Temperature Anomaly (Â°C)'].values[0]
        st.metric(label="2024ë…„ ê¸°ì¤€ ì˜¨ë„ ìƒìŠ¹", value=f"+{current_anomaly:.2f}Â°C", delta="ì‚°ì—…í™” ì´ì „ ëŒ€ë¹„")
        st.warning("ê²½ê³ : ìƒìŠ¹ ì¶”ì„¸ê°€ ê°€íŒŒë¦…ë‹ˆë‹¤.")

    st.markdown("### ğŸ” ì£¼ìš” ë©¸ì¢… ìœ„ê¸°ì¢… ë°ì´í„°")
    st.write("ê¸°í›„ ë³€í™”ë¡œ ì¸í•´ ì„œì‹ì§€ë¥¼ ìƒê³  ìˆëŠ” ëŒ€í‘œì ì¸ ë™ë¬¼ë“¤ì…ë‹ˆë‹¤.")
    
    species_data = {
        "ì´ë¦„": ["ë¶ê·¹ê³°", "ì‚°í˜¸ì´ˆ", "ë°”ë‹¤ê±°ë¶", "í™©ì œí­ê·„"],
        "ìœ„í—˜ ìš”ì¸": ["í•´ë¹™ ê°ì†Œ", "í•´ìˆ˜ ì˜¨ë‚œí™”/ì‚°ì„±í™”", "í•´ìˆ˜ë©´ ìƒìŠ¹ (ì‚°ë€ì§€ íŒŒê´´)", "ìœ ë¹™ ê°ì†Œ"],
        "ë©¸ì¢…ìœ„ê¸° ë“±ê¸‰": ["ì·¨ì•½ (VU)", "ìœ„ê¸‰ (CR)", "ìœ„ê¸° (EN)", "ì¤€ìœ„í˜‘ (NT)"]
    }
    st.table(pd.DataFrame(species_data))

# --- 2. ìƒíƒœê³„ ì‹œë®¬ë ˆì´í„° íƒ­ ---
elif menu == "ìƒíƒœê³„ ì‹œë®¬ë ˆì´í„°":
    st.subheader("ğŸŒ¡ï¸ ì˜¨ë„ ìƒìŠ¹ ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´í„°")
    st.markdown("ì§€êµ¬ ì˜¨ë„ê°€ **Në„ ìƒìŠ¹**í–ˆì„ ë•Œ, ìƒíƒœê³„ì— ì–´ë–¤ ì¼ì´ ë²Œì–´ì§ˆê¹Œìš”?")

    # ìŠ¬ë¼ì´ë”ë¡œ ì˜¨ë„ ì¡°ì ˆ
    temp_rise = st.slider("ì§€êµ¬ ì˜¨ë„ ìƒìŠ¹í­ ì„ íƒ (Â°C)", min_value=1.0, max_value=5.0, step=0.5, value=1.5)

    st.divider()
    
    # ì˜¨ë„ë³„ ì‹œë‚˜ë¦¬ì˜¤ ë¡œì§
    col1, col2 = st.columns(2)
    
    with col1:
        st.markdown(f"### ğŸŒ¡ï¸ +{temp_rise}Â°C ì„¸ê³„")
        if temp_rise < 1.5:
            st.success("ì•„ì§ í¬ë§ì´ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê¸°ìƒ ì´ë³€ì€ ì—¬ì „íˆ ì¡´ì¬í•©ë‹ˆë‹¤.")
            image_emoji = "ğŸŒ¤ï¸"
        elif 1.5 <= temp_rise < 2.0:
            st.warning("í‹°í•‘ í¬ì¸íŠ¸(Tipping Point)ì— ê·¼ì ‘í–ˆìŠµë‹ˆë‹¤. ì‚°í˜¸ì´ˆì˜ 70~90%ê°€ ì†Œë©¸í•©ë‹ˆë‹¤.")
            image_emoji = "ğŸ”¥"
        elif 2.0 <= temp_rise < 3.0:
            st.error("ëŒì´í‚¬ ìˆ˜ ì—†ëŠ” í”¼í•´ê°€ ë°œìƒí•©ë‹ˆë‹¤. ë¶ê·¹ì˜ ë¹™í•˜ê°€ ì—¬ë¦„ì— ì™„ì „íˆ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
            image_emoji = "ğŸ»â€â„ï¸ğŸ’§"
        else:
            st.error("ëŒ€ë©¸ì¢… ìœ„ê¸°ì…ë‹ˆë‹¤. ì£¼ìš” ê³¡ë¬¼ ìƒì‚°ëŸ‰ì´ ê¸‰ê°í•˜ê³  ìƒë¬¼ ë‹¤ì–‘ì„±ì´ ë¶•ê´´ë©ë‹ˆë‹¤.")
            image_emoji = "â˜ ï¸"
            
        st.markdown(f"<h1 style='text-align: center; font-size: 100px;'>{image_emoji}</h1>", unsafe_allow_html=True)

    with col2:
        st.markdown("### ğŸ¦‹ ìƒë¬¼í•™ì  ì˜í–¥ ì˜ˆì¸¡")
        impacts = []
        if temp_rise >= 1.5:
            impacts.append("âŒ **ì‚°í˜¸ì´ˆ ë°±í™” í˜„ìƒ** ì‹¬í™”")
            impacts.append("ğŸ **ê³¤ì¶© ì„œì‹ì§€** 18% ê°ì†Œ")
        if temp_rise >= 2.0:
            impacts.append("ğŸŒ¾ **ì‹ëŸ‰ ì‘ë¬¼(ë°€, ì˜¥ìˆ˜ìˆ˜)** ìƒì‚°ì„± ì €í•˜")
            impacts.append("ğŸŸ **í•´ì–‘ ì–´ë¥˜** 300ë§Œ í†¤ ê°ì†Œ ì˜ˆìƒ")
        if temp_rise >= 3.0:
            impacts.append("ğŸŒ² **ì•„ë§ˆì¡´ ì—´ëŒ€ìš°ë¦¼**ì˜ ì‚¬ë°”ë‚˜í™” ì‹œì‘")
            impacts.append("ğŸ¦Ÿ **ì „ì—¼ë³‘ ë§¤ê°œì²´(ëª¨ê¸° ë“±)** í™œë™ ì˜ì—­ ê³ ìœ„ë„ í™•ì‚°")
        if temp_rise >= 4.0:
            impacts.append("ğŸŒ **ì§€êµ¬ ìƒë¬¼ì¢…** 50% ì´ìƒ ë©¸ì¢… ìœ„ê¸°")

        for item in impacts:
            st.write(item)

# --- 3. í•œêµ­ì˜ ì‚¬ë¡€ íƒ­ ---
elif menu == "í•œêµ­ì˜ ì‚¬ë¡€":
    st.subheader("ğŸ‡°ğŸ‡· í•œë°˜ë„ ìƒíƒœê³„ì˜ ë³€í™”")
    st.markdown("ìš°ë¦¬ë‚˜ë¼ì—ì„œë„ ê¸°í›„ë³€í™”ë¡œ ì¸í•œ ì‹ìƒ ë³€í™”ê°€ ëšœë ·í•˜ê²Œ ë‚˜íƒ€ë‚˜ê³  ìˆìŠµë‹ˆë‹¤.")
    
    tab1, tab2 = st.tabs(["ğŸ ì‚¬ê³¼ ì¬ë°°ì§€ ë¶ìƒ", "ğŸŒ² ì¹¨ì—½ìˆ˜ ì§‘ë‹¨ ê³ ì‚¬"])
    
    with tab1:
        st.markdown("#### êµ­ë¯¼ ê³¼ì¼ ì‚¬ê³¼ì˜ ì¬ë°°ì§€ê°€ ì‚¬ë¼ì§„ë‹¤?")
        st.write("ê³¼ê±° ëŒ€êµ¬/ê²½ë¶ì´ ì£¼ì‚°ì§€ì˜€ë˜ ì‚¬ê³¼ëŠ” í˜„ì¬ ê°•ì›ë„ ì–‘êµ¬, ì² ì›ê¹Œì§€ ë¶ìƒí–ˆìŠµë‹ˆë‹¤.")
        
        # ê°€ìƒì˜ ì¬ë°°ì§€ ìœ„ë„ ë°ì´í„°
        apple_loc = pd.DataFrame({
            'lat': [35.8, 36.5, 37.1, 38.1],
            'lon': [128.6, 128.1, 128.5, 128.2],
            'ì—°ë„': ['1980ë…„ëŒ€', '2000ë…„ëŒ€', '2020ë…„ëŒ€', '2050ë…„(ì˜ˆì¸¡)']
        })
        st.map(apple_loc, zoom=6)
        st.caption("ë¹¨ê°„ ì : ì‚¬ê³¼ ì¬ë°° ê°€ëŠ¥ ì§€ì—­ì˜ ì¤‘ì‹¬ ì´ë™ (ë‚¨ -> ë¶)")

    with tab2:
        st.markdown("#### ë°±ë‘ëŒ€ê°„ ì¹¨ì—½ìˆ˜ì˜ ìœ„ê¸°")
        st.info("êµ¬ìƒë‚˜ë¬´ì™€ ê°™ì€ ê³ ì‚°ì§€ëŒ€ ì¹¨ì—½ìˆ˜ë“¤ì´ ê²¨ìš¸ì²  ê¸°ì˜¨ ìƒìŠ¹ê³¼ ê°€ë­„ìœ¼ë¡œ ë§ë¼ ì£½ê³  ìˆìŠµë‹ˆë‹¤.")
        st.progress(70, text="êµ¬ìƒë‚˜ë¬´ ê³ ì‚¬ìœ¨ (ì§€ë¦¬ì‚° ì¼ë¶€ ì§€ì—­ 70% ì´ìƒ ì§„í–‰)")
        st.write("ì´ë“¤ì€ í•œë°˜ë„ ê³ ìœ ì¢…ìœ¼ë¡œ, ë©¸ì¢… ì‹œ ë³µì›ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.")

# --- í‘¸í„° ---
st.divider()
st.markdown("Created with Python & Streamlit | Data Source: Simulated for Demo")
